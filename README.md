# Тестовое задание: Модульная система способностей
# Использование
## Ability
`Способости` являются Scriptable Object'ами.

`Способность` включает в себя `селектор` и список `компонентов`.
При применении `способности` сначала валидируется точка применения `способности` и наполняется `контекст`.
Далее, сформированный `контекст` последовательно попадает в каждый `компонент` `способности`, засчет этого формируется последовательное поведение `способности`.

Создаются через контекстное меню `Scriptable Objects/Abilities/Ability`.

## Контекст применения способности
Включает в себя следующие данные:
1. `Caster` - GameObject, кастующий `способность`.
2. `Targets` - список GameObject'ов, попавших под действие способности.
3. `CastPoint` - точка применения `способности`.

## Selector
`Selector` - абстрактный класс, отвечающий за валидацию выбранной точки и наполнение `контекста` `способности`.
У каждой `способности` должен присутствовать `селектор`.

Вызовите список реализованных `селекторов` и выберите один, нажав на кнопку `Change Selector` в инспекторе `способности`.

### Реализации:
1. `AOERelativeSelector` - выбирает цели в определенном радиусе от точки. Точка располагается относительно `Caster'а`.
2. `AOESelector` - выбирает цели в определенном радиусе от точки. Точку выбирает пользователь. Точку можно поставить в определенном радиусе.
3. `CasterSelector` - выбирает `Caster'а` в качестве цели.
4. `SoloUnitSelector` - выбирает одного юнита в радиусе от `Caster'а`, ближайшего к точке. Точку выбирает пользователь.

## AbilityComponent
`AbilityComponent` - абстрактный класс, реализации которого формируют поведение `способностей`.
При использовании `способности` получает `контекст` и, в зависимости от реализации, что-то делает.

Чтобы добавить `компонент` на `способность`, нажмите `Add Component` в инспекторе `способности`.

### Реализации:
1. `AudioClipPlayer` - проигрывает `AudioClip` в `CastPoint`. Громкость настраивается.
2. `Delay` - на случай, если есть необходимость между выполняемыми `компонентами` подождать какое-то время.
3. `SpawnBurstParticlesEffect` - спавнит единичный визуальный эффект. В качестве точек спавна можно выбрать `Caster/Targets/CastPoint`.
4. `SpawnContinuousParticlesEffect` - спавнит продолжительный визуальный эффект. Длительность настраивается. В качестве точек спавна можно выбрать `Caster/Targets/CastPoint`. Опционально можно закрепить за объектом спавна.
5. `AddStatusEffect` - добавляет статус эффект на цель. Длительность эффекта настраивается. В качестве цели можно выбрать `Caster/Targets`.
6. `AnimatorSetTrigger` - вызывает `SetTrigger()` у `CharacterAnimator`. Вид триггера настраивается.
7. `CharacterAddImpulse` - толкает цель в заданном направлении через вызов `AddImpulse()` у `CharacterMotor`. В качестве цели можно выбрать `Caster/Targets`. Настраивается направление толчка.
8. `InstantDamage` - наносит урон `IDamageable`. В качестве цели можно выбрать `Caster/Targets`

# Масштабирование
Предполагаемый вектор масштабирования системы - `селекторы` и `компоненты` способностей. Помимо этого, хоть проект и демонстрационный, в нем и некоторые другие вещи сделаны с оглядкой на масштабирование.

`Селекторы` и `компоненты` представляют из себя ScriptableObject'ы, их инспектор отображается внутри инспектора `способности`. Есть опция написать кастомный эдитор, он также будет корректно отображаться.

Помимо написания реализации, больше ничего не требуется делать, новые реализованные классы появятся в соответствующих меню `Change Selector` и `Add Component`.

## Selector
Чтобы написать свою реализацию `селектора`, необходимо унаследоваться от абстрактного класса `Core.Abilities.Selector`:
```csharp
namespace Core.Abilities
{
    public abstract class Selector : ScriptableObject 
    {
        public abstract bool Momentum { get; }

        public virtual string Description => null;

        public abstract void ValidateSelection(Vector3 rawCastPoint, ISelectionContext context);
    }
}
```

1. `Momentum` - селектор обрабатывает контекст за одну итерацию или ждет игрока?
2. `Description` - опциональное описание, отображается в инспекторе способности.
3. `ValidateSelection` - обязательный к реализации метод, призванный наполнить `ISelectionContext` контекст. 

`ISelectionContext` выглядит следующим образом:
```csharp
namespace Core.Abilities
{
    public interface ISelectionContext
    {
        public GameObject Caster { get; }

        public bool ValidSelection { get; set; }

        public Vector3 CastPoint { get; set; }

        public void ClearTargets();

        public void AddTarget(GameObject target);
    }
}
```
...и позволяет набивать цели, менять итоговый `CastPoint`, валидировать правильность выбранной области. При `ValidSelection == false` способность не будет выполняться.

## AbilityComponent
Чтобы написать свою реализацию `компонента`, необходимо унаследоваться от абстрактного класса `Core.Abilities.AbilityComponent` и реализовать метод `float StartExecute(IReadOnlyContext context)`.
Метод вызывается при применении `способности` последовательно один раз у каждого `компонента`.
Возвращаемый `float` - время ожидания в секундах перед переходом к следующему `компоненту`.
